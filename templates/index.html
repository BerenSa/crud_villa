<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>CRUD Seguro</title>

<style>
body{
    font-family: system-ui;
    background: linear-gradient(120deg,#4facfe,#00f2fe);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    margin:0;
}

.container{
    background:white;
    padding:30px;
    border-radius:14px;
    width:420px;
    box-shadow:0 20px 40px rgba(0,0,0,.2);
}

h1{
    margin-top:0;
}

input{
    padding:10px;
    width:70%;
    border-radius:8px;
    border:1px solid #ccc;
}

button{
    padding:10px 14px;
    border:none;
    border-radius:8px;
    background:#4facfe;
    color:white;
    cursor:pointer;
    margin-left:5px;
}

button:hover{
    opacity:.85;
}

.row{
    display:flex;
    justify-content:space-between;
    margin-top:12px;
    padding:10px;
    background:#f7f7f7;
    border-radius:8px;
}

.delete{ background:#ff4d4d }
.edit{ background:#ffc107;color:black }

.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:none;
    justify-content:center;
    align-items:center;
}

.modal-box{
    background:white;
    padding:20px;
    border-radius:12px;
}
</style>
</head>

<body>

<div class="container">
<h1>CRUD Seguro</h1>

<input id="txt">
<button onclick="add()">Agregar</button>

<div id="list"></div>
</div>

<div class="modal" id="modal">
<div class="modal-box">
<h3>Editar</h3>
<input id="editTxt">
<button onclick="save()">Guardar</button>
<button onclick="closeModal()">Cancelar</button>
</div>
</div>

<script>

let editId=null

function clean(t){
    return t.replace(/[<>]/g,"")
}

async function load(){
    const res=await fetch("/items")
    const data=await res.json()

    const list=document.getElementById("list")
    list.innerHTML=""

    data.forEach(i=>{
        const row=document.createElement("div")
        row.className="row"

        const name=document.createElement("span")
        name.textContent=i.name

        const actions=document.createElement("div")

        const e=document.createElement("button")
        e.textContent="Editar"
        e.className="edit"
        e.onclick=()=>{
            editId=i.id
            editTxt.value=i.name
            modal.style.display="flex"
        }

        const d=document.createElement("button")
        d.textContent="Eliminar"
        d.className="delete"
        d.onclick=async()=>{
            await fetch("/items/"+i.id,{method:"DELETE"})
            load()
        }

        actions.appendChild(e)
        actions.appendChild(d)
        row.appendChild(name)
        row.appendChild(actions)
        list.appendChild(row)
    })
}

async function add(){
    const val=clean(txt.value.trim())
    if(!val) return alert("Escribe algo")

    await fetch("/items",{
        method:"POST",
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({name:val})
    })

    txt.value=""
    load()
}

async function save(){
    const val=clean(editTxt.value)

    await fetch("/items/"+editId,{
        method:"PUT",
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({name:val})
    })

    closeModal()
    load()
}

function closeModal(){
    modal.style.display="none"
}

load()

</script>
</body>
</html>
